---
title: 激活华炎魔方
description: 华炎魔方私有部署版完全免费，本教程指导您为私有部署的华炎魔方配置华炎云账户，通过华炎云激活后，可解锁所有功能限制，并支持从应用市场下载和安装软件包，或是开发、发布自己的软件包。
---

> 华炎魔方私有部署版完全免费，本教程指导您为私有部署的华炎魔方配置华炎云账户，通过华炎云激活后，可解锁所有功能限制，并支持从应用市场下载和安装软件包，或是开发、发布自己的软件包。

华炎魔方激活过程会执行以下操作：

* 在本地数据库中创建企业。
* 创建管理员账户，管理员用户名为手机号，初始密码为华炎云管理控制台中配置的默认密码。
* 自动下载免费的私有部署许可证，解锁华炎魔方所有功能。
* 自动下载安装当前企业已购买的软件包。


:::tip
华炎魔方激活完成后，可断网使用。

:::

## 注册账户

请进入华炎魔方客户门户（<https://console.steedos.cn/>），并登录进系统。如果没有账户，请先注册。

### 新建我的魔方

在管理控制台 - 我的魔方中，新建我的魔方。

在这里设置的初始密码就是激活过程中自动为本地魔方项目创建的初始管理员账户的默认密码。

#### 为全新项目激活

全新项目指的是以下情况：

* 刚了解华炎魔方，还没有开始任何私有项目开发和部署。
* 本地已经准备好华炎魔方私有项目，可能已经跑起服务了，但是还没有在该项目下注册过账户。

我们推荐这种激活方式，这种方式下新建我的魔方时“魔方ID”字段无需输入内容，系统会自动给出您的魔方ID 。

#### 为已有项目激活

已有项目指的是以下情况：

* 已有老版本私有项目，包括已正式上线的项目，想升级到最新版本。
* 本地已建好的最新版本（指的是2.1以上版本）华炎魔方私有项目，并且已经在该私有项目下注册过账户。

只要在云平台上新建我的魔方之前，任何已有项目下已经注册过账户开始使用，本地就已经存在了华炎魔方ID，此时如果在云平台上新建我的魔方时，“魔方ID”字段就不可以为空，必须输入原项目的魔方ID。


:::info
关于2.1版本之前的老项目升级到最新版本请参考文档：[升级已有老版本项目](/docs/deploy/upgrade)。

:::

### 新建私有部署

选择我的魔方，在详情页，点击私有部署处的“新建”按钮，即可新建一条私有部署记录。

创建的私有部署记录中，包含魔方ID和 API Key，需在后续步骤中，配置为私有部署中的环境变量。

* 魔方ID；
* 私有部署的API Key 。

点击刚新建好的私有部署记录详细界面右上角的“复制激活参数”按钮可以把相关环境变量配置复制下来。

## 激活华炎魔方

### 环境变量

可以通过配置环境变量来为华炎魔方项目设置很多系统参数，其中也包括激活华炎魔方时需要的相关参数。

在华炎魔方中使用根目录下名为`.env` 和 `.env.local` 的文件来配置环境变量，后者用于保存本地环境的配置，会覆盖`.env`文件中的配置。`.env.local`文件中可以存放密钥等敏感信息，已加入到`.gitignore`文件清单，不会提交到git仓库中。

### 运行项目

在运行华炎魔方前首先需要安装部署华炎魔方，本地部署请参阅文档 [安装部署](https://beta.steedos.cn/docs/deploy)，部署好项目后请按教程中指示启动服务。

我们推荐使用 [GitPod](https://gitpod.io/) 来启动远程开发环境，以免去本地安装开发环境的繁琐过程，详情请查阅教程 [启动远程开发环境](https://beta.steedos.cn/docs/developer/gitpod)。

### 配置环境变量

第一次运行项目时可以在控制台看到提示“请配置环境变量STEEDOS_CLOUD_SPACE_ID和STEEDOS_CLOUD_API_KEY”，但是我们也可以看到项目运行起来后自动打开了一个浏览器窗口访问运行好的华炎魔方，只是因为没有激活华炎魔方没有账户可以登录使用所以显示了激活华炎魔方的初始化界面。

 ![](https://console.steedos.cn/api/files/images/sazPKv6DaPzXBBy8T)

在该初始化界面中输入之前点击私有部署记录详细界面右上角“复制激活参数”按钮复制的内容，其中已经包含了激活华炎魔方需要的两个环境变量，提交后会自动把相关环境变量值保存到`.env.local`文件中：

```bash
[metadata]
METADATA_SERVER=http://localhost:5000
METADATA_APIKEY=#会自动填充为初始界面中输入的环境变量值

[steedos-cloud]
STEEDOS_CLOUD_SPACE_ID=#会自动填充为初始界面中输入的环境变量值
STEEDOS_CLOUD_API_KEY=#会自动填充为初始界面中输入的环境变量值
```

其中`METADATA_SERVER `和` METADATA_APIKEY`这两个环境变量是用于同步元数据，详细请参考文档 [同步元数据](/docs/developer/getting-started#%E5%90%8C%E6%AD%A5%E5%85%83%E6%95%B0%E6%8D%AE)。

在系统自动保存好相关环境变量后会连接华炎云服务，激活本地的华炎魔方，自动下载不限制用户数、不限制访问时间的许可证，然后会在数据库中创建企业并自动创建好管理员账户，最后页面会自动跳转到登录界面，使用私有部署的华炎魔方初始账户登录即可进入系统主界面了。

激活完成后，可以在设置 - 公司设置 - 许可证菜单中查看到私有部署许可证信息。

## 应用商城

在购买并开通华炎云服务后，您的华炎魔方默认只包含一个叫“办公”的应用。在华炎魔方的应用商城，则提供了更多的企业应用，包括众多合作伙伴发布的各类应用。您可以选择购买并开通这些应用。

点这里进入[华炎魔方应用商城](https://www.steedos.cn/collections/steedos-packages)。

### 购买应用

 ![](https://console.steedos.cn/api/files/images/PoqfA3ZHfxEWXzF5z)我们可以在华炎魔方应用商城浏览和购买应用。

* 浏览并选择应用
* 点击购买
* 在提交订单后的二维码页面，使用手机微信付款。
* 您可以继续选择购买其他的应用。

### 安装应用

 ![](https://console.steedos.cn/api/files/images/hvA8sf7QfkTDB88Zb)应用商场中选购好应用后，可以一键开通所有已购买应用。

* 登录进入您私有部署的华炎魔方，设置 - 软件包。
* 点击“安装已购买应用”，系统开始安装所有的已购买、待安装应用。
* 系统会在服务端自动安装已购买的软件包。
* 安装完成，会逐一启用各应用。应用全部启用后，可以看到应用的状态已发生变化。
* 后续还可以在已安装软件包列表进行相应的操作，按实际需求来升级、停用、卸载或重新加载某些软件包。
* 进入应用程序启动器，就可以看到已成功部署的应用，点击即可使用应用。
* 刷新浏览器，可以查看应用

## 常见问题解答

### 在哪里看初始账户密码？为什么登录不进去？

初始账户就是登录华炎云时绑定的手机号，初始密码是华炎云管理控制台中配置的默认密码，具体请点击左上角的九宫格图标，在弹出的应用程序启动器中点击“管理控制台”应用，然后在我的魔方列表找到并点击进入自己创建的魔方记录，在记录详细界面可以看到手机号和初始密码值。

如果使用上面提到的手机号和初始密码还是提示账户密码错误，请检查您是否按“激活华炎魔方→配置环境变量”小节正确配置了相关环境变量。

### 如何确认已经正确激活华炎魔方？

请使用华炎云平台上注册账户时填写的手机号登录本地华炎魔方，然后进入”设置应用>公司设置>公司”，确保进入该界面后，浏览器地址栏上的地址是以华炎云平台的魔方ID值为后缀，假设浏览器地址栏的地址以`/spaces/view/615ffbf0726ca50030255d41`结尾，那么您在云平台上新建的魔方ID的值就必须为`615ffbf0726ca50030255d41`。如果出现不一致的情况，说明有可能您本地魔方项目已经提前注册过账户了，建议修改环境变量`MONGO_URL`指向另一个空数据库。

启动服务后，请不要手动注册账户和创建企业，而应该使用激活过程中自动创建的管理员账户登录系统。

### 如何激活已有老版本华炎魔方项目

推荐使用全新数据库激活华炎魔方，请修改环境变量指向一个空的数据库 `MONGO_URL`

```javascript
 MONGO_URL=mongodb://127.0.0.1:27017/steedos
```

如果是使用全新数据库激活华炎魔方，激活过程中会额外在本地数据库中创建企业并自动创建好管理员账户，您不需要额外注册账户。

对于已经手动注册过账户的情况，建议修改环境变量`MONGO_URL`指向另一个空数据库。

关于历史数据库的激活，请参考：[升级已有老版本项目](/docs/deploy/upgrade)。

### 为什么设置的登录界面logo和背景未能生效？

可以在”设置应用>公司设置>公司”中的“登录界面”栏中设置登录界面Logo和背景图，如果设置后未能生效，可能是以下原因：

* 未正确激活华炎魔方，请参考上一个问题解答，确认您已经正确激活华炎魔方。
* 你的魔方配置文件`steedos-config.yml`并不是最新的，请从该 [地址](https://github.com/steedos/steedos-project-template) 复制一份最新的配置文件内容，确保参数`tenant._id`引用了环境变量`STEEDOS_CLOUD_SPACE_ID`而不是空值或其他环境变量。

\
